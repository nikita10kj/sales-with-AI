{% extends "users/base.html" %}
{% block content %}
<div class="col-md-10 offset-md-1 mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0"><i class="fas fa-envelope-open-text me-2"></i>Email Message</h4>
        </div>
        <div class="card-body">
            <p><strong>To:</strong> {{ email.email }}</p>
            <p><strong>Subject:</strong> {{ email.subject }}</p>
            <p><strong>Message:</strong></p>
            <div class="border p-3 bg-light">
                {{ email.message|safe }}
            </div>
            <p class="mt-3 ">
                <strong>Sent:</strong> <span class="utc-time" data-utc="{{ email.created|date:'c' }}"></span>
            </p>

            <!-- Back Button -->
            <a href="{% url 'view-emails' %}" class="btn btn-primary mt-3">
                <i class="fas fa-arrow-left me-2"></i>Back to Email List
            </a>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const el = document.querySelector('.utc-time');
    if (!el) return;

    const utcDateStr = el.getAttribute('data-utc');
    const utcDate = new Date(utcDateStr);
    const localDate = new Date(utcDate.getTime());

    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);

    const emailDate = new Date(localDate.getFullYear(), localDate.getMonth(), localDate.getDate());

    let label;
    if (emailDate.getTime() === today.getTime()) {
        label = "Today";
    } else if (emailDate.getTime() === tomorrow.getTime()) {
        label = "Tomorrow";
    } else {
        label = localDate.toLocaleDateString(undefined, {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    }

    const timePart = localDate.toLocaleTimeString(undefined, {
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
    });

    el.textContent = `${label}, ${timePart}`;
});
</script>

{% endblock %}
